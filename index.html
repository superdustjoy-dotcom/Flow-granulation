<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FBG å…¨åƒæ•¸è¯å‹•ç³»çµ± - å¢åŠ é¢¨é‡æ§åˆ¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; color: #334155; }
        .glass-panel { background: #ffffff; border-radius: 1.5rem; padding: 1.5rem; box-shadow: 0 4px 20px -5px rgb(0 0 0 / 0.1); border: 1px solid #e2e8f0; }
        .slider-label { display: flex; justify-content: space-between; font-size: 0.85rem; font-weight: 700; color: #475569; margin-bottom: 0.5rem; }
        input[type=range] { width: 100%; accent-color: #2563eb; cursor: pointer; background: #f1f5f9; height: 8px; border-radius: 999px; appearance: none; }
        #particleCanvas { background: #fdfdfd; border-radius: 1rem; width: 100%; height: 260px; border: 1px solid #cbd5e1; }
        .val-display { font-family: 'JetBrains Mono', monospace; color: #2563eb; font-weight: 700; }
        .state-tag { padding: 4px 12px; border-radius: 999px; font-size: 0.75rem; font-weight: 800; border-width: 1px; }
    </style>
</head>
<body class="p-4 lg:p-8 min-h-screen">

    <div class="max-w-7xl mx-auto">
        <header class="mb-6 flex justify-between items-center pb-4 border-b border-slate-200">
            <div>
                <h1 class="text-2xl font-black text-slate-800 tracking-tight flex items-center gap-2">
                    <span class="bg-blue-600 w-2 h-6 rounded-full"></span>
                    FBG æµå‹•é€ ç²’ï¼šå«é¢¨é‡å…¨åƒæ•¸æ·±åº¦è¯å‹•
                </h1>
                <p class="text-slate-500 text-xs mt-1 font-medium">è£½è—¥å·¥ç¨‹ç†±è³ªå‚³éæ¨¡æ“¬ Â· æŠ€è¡“é¡§å•ï¼šé’æ£ </p>
            </div>
            <div id="processState" class="state-tag bg-blue-50 text-blue-700 border-blue-200">ç³»çµ±ç©©å®šä¸­</div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <div class="lg:col-span-4 space-y-4">
                <div class="glass-panel">
                    <h2 class="text-xs font-black text-blue-600 mb-6 tracking-widest uppercase border-b pb-2">åƒæ•¸é–‰ç’°æ§åˆ¶ (äº’ç›¸é€£å‹•)</h2>
                    <div class="space-y-6">
                        <div>
                            <div class="slider-label">å…¥é¢¨æº«åº¦ (Inlet) <span class="val-display"><b id="v_inlet">60</b>Â°C</span></div>
                            <input type="range" id="inletAir" min="40" max="130" value="60">
                        </div>
                        <div>
                            <div class="slider-label">é¢¨é‡ (Airflow) <span class="val-display"><b id="v_airflow">400</b> mÂ³/h</span></div>
                            <input type="range" id="airflow" min="100" max="1000" value="400">
                        </div>
                        <div>
                            <div class="slider-label">å™´æ¶²é€Ÿåº¦ (Spray) <span class="val-display"><b id="v_spray">25</b> g/m</span></div>
                            <input type="range" id="sprayRate" min="0" max="120" value="25">
                        </div>
                        <hr class="border-slate-100">
                        <div>
                            <div class="slider-label text-blue-800 font-black">ç”¢å“æº«åº¦ (Product) <span class="val-display text-blue-800"><b id="v_prod">48</b>Â°C</span></div>
                            <input type="range" id="prodTemp" min="30" max="120" value="48">
                        </div>
                        <div>
                            <div class="slider-label text-blue-800 font-black">å‡ºé¢¨æº«åº¦ (Outlet) <span class="val-display text-blue-800"><b id="v_outlet">44</b>Â°C</span></div>
                            <input type="range" id="outletAir" min="30" max="110" value="44">
                        </div>
                        <hr class="border-slate-100">
                        <div>
                            <div class="slider-label">å™´æ§é«˜åº¦ (Gun H) <span class="val-display"><b id="v_height">50</b> cm</span></div>
                            <input type="range" id="gunHeight" min="20" max="100" value="50">
                        </div>
                        <div>
                            <div class="slider-label">éœ§åŒ–å£“åŠ› (Atom.) <span class="val-display"><b id="v_atom">2.2</b> bar</span></div>
                            <input type="range" id="atomPressure" min="0.5" max="5.0" step="0.1" value="2.2">
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-4">
                <div class="glass-panel">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="font-bold text-slate-700">ğŸ”¬ é¡†ç²’å¾®è§€è¡Œç‚ºå‹•æ…‹</h2>
                        <div id="physicText" class="text-[10px] font-mono font-bold bg-slate-100 px-2 py-1 rounded text-slate-500 uppercase">Status: OK</div>
                    </div>
                    <canvas id="particleCanvas"></canvas>
                    
                    <div class="mt-4 grid grid-cols-4 gap-2">
                        <div class="p-2 bg-slate-50 rounded text-center">
                            <div class="text-[9px] font-bold text-slate-400 uppercase">ç†±èƒ½ä¾›çµ¦ç‡</div>
                            <div id="heatIndex" class="text-sm font-black text-blue-600">--</div>
                        </div>
                        <div class="p-2 bg-slate-50 rounded text-center">
                            <div class="text-[9px] font-bold text-slate-400 uppercase">æµåŒ–å“è³ª</div>
                            <div id="fluidIndex" class="text-sm font-black text-emerald-600">--</div>
                        </div>
                        <div class="p-2 bg-slate-50 rounded text-center">
                            <div class="text-[9px] font-bold text-slate-400 uppercase">è’¸ç™¼é£½å’Œåº¦</div>
                            <div id="evapIndex" class="text-sm font-black text-orange-500">--</div>
                        </div>
                        <div class="p-2 bg-slate-50 rounded text-center">
                            <div class="text-[9px] font-bold text-slate-400 uppercase">ç„¦åŒ–é¢¨éšª</div>
                            <div id="charIndex" class="text-sm font-black text-slate-700">--</div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="diagBox" class="glass-panel border-l-4 border-blue-500 bg-blue-50/30">
                        <h3 class="text-blue-800 font-bold text-sm mb-2">ğŸ’¡ å·¥ç¨‹è¨ºæ–·å»ºè­°</h3>
                        <p id="diagText" class="text-xs text-slate-600 leading-relaxed italic">åˆå§‹åŒ–å®Œæˆï¼Œè«‹æ“ä½œè—è‰²èª¿æ•´æ£’ã€‚</p>
                    </div>
                    <div class="glass-panel">
                        <h3 class="text-[10px] font-bold text-slate-400 mb-2 uppercase">ç†±å¹³è¡¡è¶¨å‹¢ (History)</h3>
                        <canvas id="trendChart" height="110"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('particleCanvas');
        const pctx = canvas.getContext('2d');
        const trendCtx = document.getElementById('trendChart').getContext('2d');
        
        let trendChart = new Chart(trendCtx, {
            type: 'line',
            data: { labels: Array(40).fill(''), datasets: [
                { label: 'ç”¢å“æº«', data: Array(40).fill(null), borderColor: '#2563eb', borderWidth: 2, pointRadius: 0, tension: 0.4 },
                { label: 'å…¥é¢¨æº«', data: Array(40).fill(null), borderColor: '#94a3b8', borderWidth: 1, pointRadius: 0, tension: 0.4 }
            ]},
            options: { responsive: true, animation: false, scales: { x: { display: false }, y: { display: true, ticks: { size: 9 } } }, plugins: { legend: { display: false } } }
        });

        let particles = [];
        function initParticles() {
            particles = [];
            for(let i=0; i<80; i++) {
                particles.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, vx: (Math.random()-0.5)*3, vy: (Math.random()-0.5)*3 });
            }
        }

        // --- å…¨åƒæ•¸æ·±åº¦é€£å‹•å¼•æ“ (å«é¢¨é‡ç‰©ç†é‚è¼¯) ---
        function sync(id) {
            let inlet = parseFloat(document.getElementById('inletAir').value);
            let flow = parseFloat(document.getElementById('airflow').value);
            let spray = parseFloat(document.getElementById('sprayRate').value);
            let prod = parseFloat(document.getElementById('prodTemp').value);
            let outlet = parseFloat(document.getElementById('outletAir').value);
            let height = parseFloat(document.getElementById('gunHeight').value);
            let atom = parseFloat(document.getElementById('atomPressure').value);

            // ç‰©ç†é‚è¼¯ï¼šå†·å»ç³»æ•¸ k åæ¯”æ–¼é¢¨é‡ (é¢¨æ„ˆå¤§ï¼Œå™´æ¶²é™æº«æ•ˆæ‡‰æ„ˆå°)
            const k = (200 / flow) * 0.95; 

            if (id === 'inletAir' || id === 'sprayRate' || id === 'airflow' || id === 'gunHeight' || id === 'atomPressure') {
                // æ­£å‘é€£å‹•ï¼šé¢¨é‡ã€å…¥é¢¨ã€å™´é€Ÿ å…±åŒæ±ºå®šç”¢æº«
                prod = inlet - (spray * k) - (height * 0.02);
                outlet = prod - (inlet * 0.05);
            } 
            else if (id === 'prodTemp') {
                // åå‘é€£å‹•ï¼šç‚ºäº†ç¶­æŒç”¢å“æº«ï¼Œè‡ªå‹•è£œå„Ÿå…¥é¢¨æº«åº¦
                inlet = prod + (spray * k) + (height * 0.02);
                outlet = prod - (inlet * 0.05);
            } 
            else if (id === 'outletAir') {
                // å‡ºé¢¨é€£å‹•
                prod = outlet + (inlet * 0.05);
                inlet = prod + (spray * k) + (height * 0.02);
            }

            // æ¥µé™ä¿®æ­£ (40-130C)
            if(inlet > 130) inlet = 130; if(inlet < 40) inlet = 40;
            if(prod > 120) prod = 120; if(prod < 25) prod = 25;
            if(outlet > 110) outlet = 110; if(outlet < 20) outlet = 20;

            // UI æ›´æ–°
            document.getElementById('inletAir').value = inlet;
            document.getElementById('prodTemp').value = prod;
            document.getElementById('outletAir').value = outlet;
            
            document.getElementById('v_inlet').innerText = Math.round(inlet);
            document.getElementById('v_airflow').innerText = flow;
            document.getElementById('v_prod').innerText = Math.round(prod);
            document.getElementById('v_outlet').innerText = Math.round(outlet);
            document.getElementById('v_spray').innerText = spray;
            document.getElementById('v_height').innerText = height;
            document.getElementById('v_atom').innerText = atom;

            // ç‹€æ…‹èˆ‡æŒ‡æ¨™
            const isCollapse = (flow < 180 && spray > 30); // é¢¨å¤ªå°ï¼Œå™´å¤ªå¤š -> å¡ŒåºŠ
            const isCharring = (inlet > 115 && prod > 88);
            const isSticking = (prod < 38);

            const st = document.getElementById('processState');
            const dt = document.getElementById('diagText');
            
            if(isCollapse) {
                st.className = "state-tag bg-slate-100 text-slate-700 border-slate-300"; st.innerText = "è­¦å ±ï¼šåºŠå±¤å¡Œé™·";
                dt.innerText = "ã€é¢¨é‡ä¸è¶³ã€‘é¢¨åŠ›ç„¡æ³•å…‹æœæ¿•é¡†ç²’é‡åŠ›èˆ‡é»çµåŠ›ï¼ŒæµåŒ–åœæ­¢ã€‚æ‡‰ç«‹å³ã€Œå¢åŠ é¢¨é‡ã€æˆ–ã€Œèª¿é™å™´é€Ÿã€ã€‚";
            } else if(isCharring) {
                st.className = "state-tag bg-red-100 text-red-700 border-red-200"; st.innerText = "è­¦å‘Šï¼šç„¦åŒ–é¢¨éšª";
                dt.innerText = "é«˜æº«å…¥é¢¨å°è‡´ç‰©æ–™è¤è®Šã€‚å¯å˜—è©¦ã€Œå¢åŠ é¢¨é‡ã€ä»¥é™æº«ä¸¦åŠ é€Ÿç†±äº¤æ›ã€‚";
            } else if(isSticking) {
                st.className = "state-tag bg-rose-100 text-rose-700 border-rose-200"; st.innerText = "ç•°å¸¸ï¼šéæ¿•ç²˜é‹";
                dt.innerText = "è’¸ç™¼èƒ½ä¸è¶³å°è‡´è¡¨é¢æ°´ä»½å †ç©ã€‚å»ºè­°ã€Œèª¿é«˜å…¥é¢¨æº«ã€æˆ–ã€Œå¢åŠ é¢¨é‡ã€ã€‚";
            } else {
                st.className = "state-tag bg-emerald-50 text-emerald-700 border-emerald-200"; st.innerText = "æ­£å¸¸ï¼šæµåŒ–ç©©å®š";
                dt.innerText = "ç†±å¹³è¡¡èˆ‡æ°£æµåŠ›å­¸çª—å£è‰¯å¥½ã€‚é¢¨é‡è¶³ä»¥ç¶­æŒç©©å®šçš„è‡¨ç•ŒæµåŒ–ç‹€æ…‹ã€‚";
            }

            document.getElementById('heatIndex').innerText = (flow * inlet / 1000).toFixed(1);
            document.getElementById('fluidIndex').innerText = flow < 250 ? "å¼±" : (flow > 700 ? "æ¥µå¼·" : "ç©©å®š");
            document.getElementById('evapIndex').innerText = ((spray / flow) * 100).toFixed(1) + "%";
            document.getElementById('charIndex').innerText = isCharring ? "âš  ç„¦åŒ–" : "ç„¡";

            // è¶¨å‹¢åœ–èˆ‡ç•«å¸ƒ
            trendChart.data.datasets[0].data.shift(); trendChart.data.datasets[0].data.push(prod);
            trendChart.data.datasets[1].data.shift(); trendChart.data.datasets[1].data.push(inlet);
            trendChart.update();

            pctx.clearRect(0,0,canvas.width,canvas.height);
            particles.forEach(p => {
                let color = "#2563eb", psize = 4;
                if(isCollapse) { color = "#64748b"; p.vx *= 0.1; p.vy = 2; } // é¡†ç²’æ²‰é™
                else if(isCharring) color = "#451a03"; 
                else if(isSticking) { color = "#be123c"; psize = 8; p.vx *= 0.5; }
                
                // é¢¨é‡å½±éŸ¿é¡†ç²’é‹å‹•é€Ÿåº¦
                p.x += p.vx * (flow/400); p.y += p.vy * (flow/400);
                if(p.x<0||p.x>canvas.width) p.vx*=-1; if(p.y<0||p.y>canvas.height) p.vy*=-1;
                pctx.beginPath(); pctx.arc(p.x, p.y, psize, 0, Math.PI*2); pctx.fillStyle = color; pctx.fill();
            });
        }

            // ç›£è½æ‰€æœ‰æ»‘æ¡¿
        ['inletAir', 'airflow', 'sprayRate', 'gunHeight', 'atomPressure', 'prodTemp', 'outletAir'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => sync(e.target.id));
        });

        canvas.width = canvas.offsetWidth; canvas.height = 260;
        initParticles();
        function animate() { sync(); requestAnimationFrame(animate); }
        sync();
    </script>
</body>
</html>
